<!doctype html>
<html lang="{{ page.lang | default: site.lang | default: 'fa' }}"
      dir="{% if page.lang == 'fa' %}rtl{% else %}ltr{% endif %}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ page.title | default: site.title }}</title>

  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
</head>
<body>
  <main>
    {{ content }}
  </main>

  <!-- Rewrite .md links to friendly permalinks on the live site -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      try {
        var base = "{{ site.baseurl | default: '' }}";
        if (base && base.endsWith('/')) base = base.slice(0, -1);

        document.querySelectorAll('a[href]').forEach(function(a){
          var href = a.getAttribute('href');
          if (!href) return;

          // Ignore absolute URLs (http: https: mailto:) and anchors starting with #
          if (/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(href) || href.startsWith('#')) return;

          // Only rewrite simple local .md filenames (like "jabar-saleh.md" or "./jabar-saleh.md" or "dir/x.md")
          var m = href.match(/^(?:\.\/)?([^?#\/]+)\.md(?:[?#].*)?$/i);
          if (!m) return;

          var filename = m[1];
          var slug = filename.replace(/\.md$/i, '');
          var newUrl = base + '/' + slug + '/';
          a.setAttribute('href', newUrl);
        });
      } catch (e) {
        console && console.error && console.error('rewrite script error', e);
      }
    });
  </script>
</body>
</html>
